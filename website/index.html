<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title> Page d'accueil </title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" />
        <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
        <style type="text/css">
            #map{ /* la carte DOIT avoir une hauteur sinon elle n'apparaît pas */
                height:400px;
                width:400px;
            }
        </style>
    </head>
    <body>
        <h1>Titre de l'outil</h1>
        <label for="cars" class="col-form-label col-form-label-lg">Sélectionner un véhicule</label>
        <select name="cars" id="cars-select">
            <option value="">Véhicule</option>
            <option value="1">Véhicule 1</option>
            <option value="2">Véhicule 2</option>
        </select>
        <button id="select" class="btn btn-primary">Selectionner</button>
        <div id="infos" class="border">
            <h2>Caractéristiques:</h2>
        </div>
        <label for="percent" class="col-form-label col-form-label-lg">Sélectionner à quel pourcentage vous souhaitez recherger votre véhicule</label>
        <select name="percent" id="percent-select">
            <option value="0">0%</option>
            <option value="1">10%</option>
            <option value="1">20%</option>
            <option value="1">30%</option>
            <option value="1">40%</option>
            <option value="1">50%</option>
            <option value="1">60%</option>
            <option value="1">70%</option>
            <option value="1">80%</option>
            <option value="1">90%</option>
            <option value="1">100%</option>
        </select>

        <label for="citySelected" class="col-form-label col-form-label-lg">Où voulez-vous vous rendre ?</label>
        <select name="citySelected" id="citySelected">
            <option value="0">Chambéry</option>
            <option value="1">Annecy</option>
            <option value="2">Grenoble</option>
            <option value="3">Lyon</option>
            <option value="4">Paris</option>
        </select>
        <button id="calcul" class="btn btn-primary">Calculer</button>

        <div id="map"></div>
    </body>

    <footer>
        <script src="/socket.io/socket.io.js"></script>
        <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
        <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
        <script>
            let socket = io();
        	let cars = document.getElementById("cars-select");
            let buttonSelect = document.getElementById("select");
            let infos = document.getElementById("infos");
            let citySelected = document.getElementById("citySelected");
            let calcul = document.getElementById("calcul");

            let map = L.map('map');
            let control = null;
            let cities = [[45.5685,5.9204], [45.9014,6.1273], [45.1868,5.7350], [45.7570,4.8326], [48.8558,2.3509]];

            socket.on('cars', function (result) {
                cars.innerHTML=''
                result.getCarsResult.string.forEach(car => {
                    cars.innerHTML+='<option value="' + car + '">' + car + '</option>'
                });
            });

            socket.on('info', function (result) {
                infos.innerHTML = '<h2>Caractéristiques:</h2>'
                infos.innerHTML += 'Nom du véhicule: ' + result.getInfoResult.string[0]
                infos.innerHTML += '<br>Autonomie: ' + result.getInfoResult.string[1] + 'Km'
                infos.innerHTML += '<br>Vitesse maximal: ' + result.getInfoResult.string[2] + 'Km/h'
                infos.innerHTML += '<br>Consomation électrique: ' + result.getInfoResult.string[3] + 'Wh/Km'
                infos.innerHTML += '<br>Charge rapide: ' + result.getInfoResult.string[4] + 'W'
                infos.innerHTML += '<br>Charge normal: ' + result.getInfoResult.string[5] + 'W'
                infos.innerHTML += '<br>Capacité: ' + result.getInfoResult.string[6] + 'Wh'
            });

            buttonSelect.addEventListener("click", function() {
                socket.emit('car', cars.value);
            });
            
            // Fonction d'initialisation de la carte
            function initMap() {

                // var marker = L.marker([lat, lon]).addTo(macarte); //pour placer un point 

                let citySelected = document.getElementById('citySelected').value;

                if(control != null) {
                    control.getPlan().setWaypoints([
                        L.latLng(45.6423,5.8726),
                        L.latLng(cities[citySelected][0], cities[citySelected][1])
                    ]);
                }
                else {
                    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
                    }).addTo(map);

                    control = L.Routing.control({
                        waypoints: [
                            L.latLng(45.6423,5.8726),
                            L.latLng(cities[citySelected][0], cities[citySelected][1])
                        ],
                        show: false
                    }).addTo(map);

                    control.on('routesfound', function(e) {
                        var routes = e.routes;
                        var summary = routes[0].summary; 
                        console.log(summary.totalDistance) //en m 
                        console.log(summary.totalTime) //en s
                    });
                }
            }

            window.onload = function(){
                initMap(); 
            };

            calcul.addEventListener("click", function() {
                console.log("click");
                initMap();
            });
        
		</script>
    </footer>
</html>