<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title> Page d'accueil </title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin="" />
        <style type="text/css">
            #map{ /* la carte DOIT avoir une hauteur sinon elle n'apparaît pas */
                height:400px;
                width:400px;
            }
        </style>
    </head>
    <body>
        <h1>Titre de l'outil</h1>
        <label for="cars" class="col-form-label col-form-label-lg">Sélectionner un véhicule</label>
        <select name="cars" id="cars-select">
            <option value="">Véhicule</option>
            <option value="1">Véhicule 1</option>
            <option value="2">Véhicule 2</option>
        </select>
        <button id="select" class="btn btn-primary">Selectionner</button>
        <div id="infos" class="border">
            <h2>Caractéristiques:</h2>
        </div>
        <label for="percent" class="col-form-label col-form-label-lg">Sélectionner à quel pourcentage vous souhaitez recherger votre véhicule</label>
        <select name="percent" id="percent-select">
            <option value="0">0%</option>
            <option value="1">10%</option>
            <option value="1">20%</option>
            <option value="1">30%</option>
            <option value="1">40%</option>
            <option value="1">50%</option>
            <option value="1">60%</option>
            <option value="1">70%</option>
            <option value="1">80%</option>
            <option value="1">90%</option>
            <option value="1">100%</option>
        </select>

        <div id="map"></div>
    </body>

    <footer>
        <script src="/socket.io/socket.io.js"></script>
        <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
        <script>
            let socket = io();
        	let cars = document.getElementById("cars-select");
            let buttonSelect = document.getElementById("select");
            let infos = document.getElementById("infos");

            socket.on('cars', function (result) {
                cars.innerHTML=''
                result.getCarsResult.string.forEach(car => {
                    cars.innerHTML+='<option value="' + car + '">' + car + '</option>'
                });
            });

            socket.on('info', function (result) {
                infos.innerHTML = '<h2>Caractéristiques:</h2>'
                infos.innerHTML += 'Nom du véhicule: ' + result.getInfoResult.string[0]
                infos.innerHTML += '<br>Autonomie: ' + result.getInfoResult.string[1] + 'Km'
                infos.innerHTML += '<br>Vitesse maximal: ' + result.getInfoResult.string[2] + 'Km/h'
                infos.innerHTML += '<br>Consomation électrique: ' + result.getInfoResult.string[3] + 'Wh/Km'
                infos.innerHTML += '<br>Charge rapide: ' + result.getInfoResult.string[4] + 'W'
                infos.innerHTML += '<br>Charge normal: ' + result.getInfoResult.string[5] + 'W'
                infos.innerHTML += '<br>Capacité: ' + result.getInfoResult.string[6] + 'Wh'
            });

            buttonSelect.addEventListener("click", function() {
                socket.emit('car', cars.value);
            });



            
            // On initialise la latitude et la longitude de Paris (centre de la carte)
            var lat = 45.6423;
            var lon = 5.8726;
            var macarte = null;
            // Fonction d'initialisation de la carte
            function initMap() {
                // Créer l'objet "macarte" et l'insèrer dans l'élément HTML qui a l'ID "map"
                macarte = L.map('map').setView([lat, lon], 15);
                // Leaflet ne récupère pas les cartes (tiles) sur un serveur par défaut. Nous devons lui préciser où nous souhaitons les récupérer. Ici, openstreetmap.fr
                L.tileLayer('https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', {
                    // Il est toujours bien de laisser le lien vers la source des données
                    attribution: 'données © <a href="//osm.org/copyright">OpenStreetMap</a>/ODbL - rendu <a href="//openstreetmap.fr">OSM France</a>',
                    minZoom: 1,
                    maxZoom: 20
                }).addTo(macarte);
            }
            window.onload = function(){
		// Fonction d'initialisation qui s'exécute lorsque le DOM est chargé
		initMap(); 
            };
        
		</script>
    </footer>
</html>